<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweet Personalized Valentine Messages ğŸ’–</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #ffe6f2 0%, #ffd1dc 50%, #ffc0cb 100%);
            min-height: 100vh;
            min-height: 100dvh; /* Dynamic viewport height for mobile */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            padding: clamp(0.5rem, 2vw, 1.5rem);
            overflow-x: hidden;
            position: relative;
        }
        .hearts-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; overflow: hidden; }
        .heart {
            position: absolute;
            font-size: 1.2rem;
            color: rgba(255, 105, 180, 0.6);
            animation: float 12s linear infinite;
            user-select: none;
        }
        @keyframes float { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-20vh) rotate(360deg); opacity: 0; } }
        .card {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(12px);
            border-radius: 2rem;
            border-radius: clamp(1rem, 4vw, 2.5rem);
            box-shadow: 0 25px 50px rgba(219, 112, 147, 0.25), 0 10px 20px rgba(0,0,0,0.08);
            padding: 2rem 1.5rem;
            padding: clamp(1.5rem, 5vw, 3rem) clamp(1rem, 4vw, 2.2rem);
            max-width: 520px;
            width: 95%;
            width: min(95%, 520px);
            text-align: center;
            border: 4px solid rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin: 1rem auto;
        }
        @media (max-width: 768px) {
            .card:hover { 
                transform: translateY(-4px) rotate(0.5deg); 
                box-shadow: 0 20px 40px rgba(219, 112, 147, 0.3); 
            }
            button:hover {
                background: linear-gradient(90deg, #ff1493, #c71585);
                transform: translateY(-2px) scale(1.02) rotate(-1deg);
                box-shadow: 0 8px 0 #c71585, 0 6px 15px rgba(255, 20, 147, 0.4);
            }
            button:active { 
                transform: translateY(2px) rotate(0.5deg) scale(0.98); 
                box-shadow: 0 3px 0 #c71585; 
            }
            .heart {
                font-size: 1rem;
            }
            .emoji-reaction {
                font-size: 1.5rem;
            }
        }
        
        @media (hover: none) and (pointer: coarse) {
            .card:hover { transform: none; }
            button:hover { transform: none; }
            input[type="text"]:focus { 
                transform: scale(1.01); 
            }
        }
        
        @media (max-width: 320px) {
            h1 {
                font-size: 1.5rem;
            }
            h1 span {
                font-size: 1.8rem;
            }
            .message-box {
                font-size: 1rem;
                min-height: 80px;
            }
            button {
                font-size: 0.9rem;
                padding: 0.7rem 1.2rem;
            }
        }
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 6vw, 3rem);
            color: #c71585;
            margin-bottom: 0.5rem;
            margin-bottom: clamp(0.4rem, 2vw, 0.6rem);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            gap: clamp(0.3rem, 2vw, 0.8rem);
            flex-wrap: wrap;
        }
        h1 span { font-size: clamp(2.5rem, 7vw, 3.5rem); }
        .sub { 
            color: #db7093; 
            margin-bottom: 1rem;
            margin-bottom: clamp(0.8rem, 3vw, 1.5rem); 
            font-style: italic; 
            font-size: clamp(1rem, 3.5vw, 1.25rem); 
            opacity: 0.9; 
            line-height: 1.4;
        }
        .name-section { margin-bottom: 2rem; display: flex; flex-direction: column; gap: 1rem; align-items: center; }
        .category-section { margin-bottom: 1rem; display: flex; flex-direction: column; gap: 0.6rem; align-items: center; }
        .category-label { color: #a52a2a; font-weight: 600; font-size: clamp(1rem, 3.2vw, 1.1rem); }
        select {
            padding: clamp(0.6rem, 2vw, 0.75rem) clamp(1rem, 3vw, 1.2rem);
            font-size: clamp(1rem, 3.5vw, 1.1rem);
            border: 3px solid #ff69b4;
            border-radius: clamp(1rem, 3vw, 1.6rem);
            width: clamp(70%, 85%, 320px);
            max-width: 320px;
            background: #fff0f5;
            color: #a52a2a;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        select:focus { outline: none; border-color: #c71585; box-shadow: 0 0 0 3px rgba(199, 21, 133, 0.2); }
        input[type="text"] {
            padding: 0.8rem 1.2rem;
            padding: clamp(0.6rem, 2vw, 0.8rem) clamp(1rem, 3vw, 1.5rem);
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            border: 3px solid #ff69b4;
            border-radius: 1.5rem;
            border-radius: clamp(1rem, 3vw, 2rem);
            width: 85%;
            width: clamp(70%, 85%, 300px);
            max-width: 280px;
            background: #fff0f5;
            color: #a52a2a;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        input[type="text"]:focus { outline: none; border-color: #c71585; box-shadow: 0 0 0 3px rgba(199, 21, 133, 0.2); transform: scale(1.02); }
        .message-box {
            background: linear-gradient(145deg, #fff0f5, #fff);
            border-radius: 2rem;
            border-radius: clamp(1.2rem, 4vw, 2.5rem);
            padding: 1.5rem 1.2rem;
            padding: clamp(1rem, 4vw, 2.2rem) clamp(0.8rem, 3vw, 1.8rem);
            margin: 1rem 0;
            margin: clamp(0.8rem, 3vw, 1.5rem) 0;
            font-size: clamp(1.2rem, 4vw, 1.6rem);
            color: #a52a2a;
            font-weight: 600;
            box-shadow: inset 0 6px 12px rgba(0,0,0,0.04), 0 6px 0 #ffb6c1;
            border: 3px solid #ff69b4;
            min-height: 120px;
            min-height: clamp(100px, 25vh, 160px);
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-word;
            transition: all 0.4s ease;
            position: relative;
            line-height: 1.3;
        }
        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.4em;
            background: #c71585;
            vertical-align: middle;
            animation: blink 0.8s infinite;
            margin-left: 2px;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .buttons { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 0.8rem;
            gap: clamp(0.5rem, 2vw, 1rem); 
            justify-content: center; 
            margin-top: 1rem;
            margin-top: clamp(0.8rem, 3vw, 1.5rem); 
        }
        
        @media (max-width: 480px) {
            .buttons {
                flex-direction: column;
                align-items: stretch;
            }
            button {
                width: 100%;
                max-width: 280px;
                margin: 0 auto;
            }
        }
        button {
            background: linear-gradient(90deg, #ff69b4, #ff1493);
            color: white;
            border: none;
            padding: 0.9rem 1.8rem;
            padding: clamp(0.8rem, 2.5vw, 1.1rem) clamp(1.5rem, 4vw, 2.5rem);
            font-size: clamp(1.1rem, 3.5vw, 1.4rem);
            border-radius: 2rem;
            border-radius: clamp(1.2rem, 3vw, 3rem);
            cursor: pointer;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 8px 0 #c71585, 0 4px 15px rgba(255, 20, 147, 0.4);
            transition: all 0.2s ease;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            gap: clamp(0.3rem, 1.5vw, 0.6rem);
            border: 3px solid #fff0f5;
            min-height: 44px; /* iOS touch target minimum */
            white-space: nowrap;
        }
        button:hover {
            background: linear-gradient(90deg, #ff1493, #c71585);
            transform: translateY(-4px) scale(1.04) rotate(-2deg);
            box-shadow: 0 15px 0 #c71585, 0 10px 25px rgba(255, 20, 147, 0.5);
        }
        button:active { transform: translateY(5px) rotate(1deg) scale(0.95); box-shadow: 0 5px 0 #c71585; }
        .footer { 
            margin-top: 1.5rem;
            margin-top: clamp(1rem, 3vw, 2.5rem); 
            color: #db7093; 
            font-size: clamp(0.9rem, 2.5vw, 1.1rem); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 0.3rem;
            gap: clamp(0.2rem, 1.5vw, 0.5rem); 
            opacity: 0.9; 
            flex-wrap: wrap;
            line-height: 1.3;
        }
        .heart-bullet { animation: pulse 1.8s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ff69b4;
            position: absolute;
            animation: confetti-fall 3s linear;
            z-index: 1000;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .emoji-reaction {
            position: absolute;
            font-size: 2rem;
            animation: emoji-pop 1s ease-out;
            pointer-events: none;
            z-index: 1000;
        }
        @keyframes emoji-pop {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); }
            100% { transform: scale(0) rotate(360deg) translateY(-50px); opacity: 0; }
        }
        
        .love-meter {
            background: linear-gradient(90deg, #ff69b4, #ff1493, #c71585);
            height: 8px;
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
            position: relative;
        }
        .love-meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ff69b4);
            border-radius: 4px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            75% { transform: translateX(5px) rotate(2deg); }
        }
        
        .bounce {
            animation: bounce 0.6s;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-20px); }
            50% { transform: translateY(-10px); }
            75% { transform: translateY(-15px); }
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(199, 21, 133, 0.18);
            backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 2000;
        }
        .modal-overlay[hidden] { display: none; }
        .modal {
            width: min(92vw, 420px);
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid rgba(255, 105, 180, 0.55);
            border-radius: clamp(1rem, 4vw, 1.8rem);
            box-shadow: 0 25px 50px rgba(219, 112, 147, 0.28), 0 10px 20px rgba(0,0,0,0.08);
            padding: 1.4rem 1.2rem;
            text-align: center;
        }
        .modal-title {
            font-family: 'Playfair Display', serif;
            color: #c71585;
            font-size: clamp(1.5rem, 5vw, 2rem);
            margin-bottom: 0.35rem;
        }
        .modal-sub {
            color: #a52a2a;
            opacity: 0.9;
            font-size: clamp(1rem, 3.5vw, 1.1rem);
            margin-bottom: 1rem;
            line-height: 1.35;
        }
        .modal-actions {
            display: grid;
            gap: 0.7rem;
            margin-top: 0.6rem;
        }
        .secondary-btn {
            background: linear-gradient(90deg, #ffd1dc, #ffe6f2);
            color: #c71585;
            box-shadow: 0 8px 0 rgba(199, 21, 133, 0.35), 0 4px 15px rgba(199, 21, 133, 0.15);
        }
        .secondary-btn:hover {
            background: linear-gradient(90deg, #ffe6f2, #ffd1dc);
        }
    </style>
</head>
<body>
    <div class="hearts-bg" id="heartsContainer"></div>

    <div class="card">
        <h1><span>ğŸ’</span> Personalized Valentine <span>ğŸ’</span></h1>
        <div class="sub">Enter a name to make the messages extra special ğŸ’Œ</div>

        <div class="name-section" id="nameSection">
            <input type="text" id="nameInput" placeholder="Enter their name (e.g., My love)" aria-label="Enter name for personalization">
            <button id="saveNameBtn">Save Name & Start</button>
        </div>

        <div class="category-section" id="categorySection">
            <div class="category-label">Pick a vibe ğŸ’«</div>
            <select id="categorySelect" aria-label="Pick message category">
                <option value="all">All</option>
                <option value="cute">Cute</option>
                <option value="funny">Funny</option>
                <option value="poetic">Poetic</option>
                <option value="spicy">Spicy</option>
            </select>
        </div>

        <div class="modal-overlay" id="chooseNameOverlay" hidden>
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="chooseNameTitle">
                <div class="modal-title" id="chooseNameTitle">Choose a name ğŸ’</div>
                <div class="modal-sub" id="chooseNameText"></div>
                <div class="modal-actions">
                    <button id="useSavedNameBtn" type="button">Use saved name</button>
                    <button id="enterNewNameBtn" type="button" class="secondary-btn">Enter a new name</button>
                </div>
            </div>
        </div>

        <div class="message-box" id="messageDisplay">
            ğŸ’– Your personalized message awaits...
        </div>
        
        <div class="love-meter">
            <div class="love-meter-fill" id="loveMeterFill" style="width: 0%"></div>
        </div>
        
        <div class="emoji-reactions" id="emojiReactions"></div>

        <div class="buttons">
            <button id="generateBtn" aria-label="Generate a new love message"><span>â¤ï¸</span> Generate Love <span>â¤ï¸</span></button>
            <button id="shareBtn" aria-label="Share this message"><span>ğŸ”—</span> Share Love <span>ğŸ’•</span></button>
            <button id="changeNameBtn" style="display:none;">Change Name</button>
        </div>

        <div class="footer">
            <span class="heart-bullet">ğŸ’˜</span> Made with love in Lusaka <span class="heart-bullet">ğŸ’˜</span>
        </div>
    </div>

    <script>
            (function() {
                const messages = [
                    "you make my heart skip a beat! ğŸ’“",
                    "I'm so sweet on you, it's unhealthy! ğŸ«",
                    "You're peanut butter to my jelly. ğŸ¥œ",
                    "If kisses were snowflakes, I'd send you a blizzard. â„ï¸ğŸ’‹",
                    "You're reason I believe in love at first sight. ğŸ‘€â¤ï¸",
                    "I love you more than pizza... and that's serious! ğŸ•",
                    "You're candy to my heart. ğŸ¬",
                    "Every love story is beautiful, but ours is my favorite. ğŸ“–ğŸ’•",
                    "You're missing piece I never knew I needed. ğŸ§©",
                    "I'd pick you even in a lineup of a million faces. ğŸ«µğŸŒŸ",
                    "You've stolen a piece of my heart, and I don't want it back. ğŸ’”â¡ï¸â¤ï¸",
                    "Being with you feels like a permanent Valentine's Day. ğŸŒ¹",
                    "You're marshmallow to my hot chocolate. â˜•",
                    "If I had a flower for every time I thought of you, I'd walk in an eternal garden. ğŸŒ¸",
                    "You're apple of my eye (and cinnamon to my roll). ğŸğŸ¥",
                    "You're my favorite notification in a world full of noise ğŸ’Œ",
                    "If loving you was a crime, I'd happily do life without parole â¤ï¸",
                    "You turn my ordinary moments into the best love story ever told ğŸ“–",
                    "My heart has your name written in permanent marker ğŸ–¤â¡ï¸â¤ï¸",
                    "You're the kind of magic I didn't know existed until you smiled âœ¨",
                    "Every sunrise feels like a love letter addressed to us ğŸŒ…ğŸ’•",
                    "You're the 'why' behind all my butterflies ğŸ¦‹",
                    "I love you in every language, even the ones I haven't learned yet ğŸŒâ¤ï¸",
                    "You're my comfort playlist on repeat ğŸ¶ğŸ’–",
                    "If I could bottle how you make me feel, it'd be the best perfume ever made ğŸ«™âœ¨",
                    "You're proof that the best things in life come with zero warning signs ğŸ˜â¤ï¸",
                    "My favorite place is anywhere you're holding my hand ğŸ¤ğŸ’",
                    "You make falling in love feel like the easiest thing I've ever done ğŸª‚",
                    "You're the plot twist that made my whole story better ğŸ“šğŸ’˜",
                    "I didn't know hearts could glow until you walked into my life ğŸŒŸ",
                    "You're my safe word, my wild side, and everything in between ğŸ”¥â¤ï¸",
                    "Loving you is my favorite bad habit (and I never want to quit) ğŸ˜ˆğŸ’•",
                    "You're the reason 'forever' doesn't scare me anymore ğŸ•Šï¸",
                    "If kisses were stars, you'd have your own galaxy by now ğŸŒŒğŸ’‹",
                    "You're still the first person I want to text good morning and good night every single day â˜€ï¸ğŸŒ™",
                    "You're the sweetest part of my day ğŸ¯â¤ï¸",
                    "I like you a latte â˜•ğŸ’–",
                    "You + me = my favorite kind of math ğŸ’",
                    "You make my heart smile ğŸ˜ŠğŸ’˜",
                    "If love had a playlist, you'd be my #1 track ğŸ¶â¤ï¸",
                    "You're my favorite hello and my hardest goodbye ğŸ‘‹ğŸ’—",
                    "With you, even silence feels romantic ğŸŒ™ğŸ’",
                    "Your love feels like home ğŸ¡ğŸ’–",
                    "You make ordinary moments feel magical âœ¨ğŸ’•",
                    "If kisses were currency, we'd be millionaires ğŸ’‹ğŸ’°",
                    "I want you closeâ€”now and always ğŸ”¥â¤ï¸",
                    "Come hereâ€”my arms miss you ğŸ¤—ğŸ’˜"
                ];

                const messageDisplay = document.getElementById('messageDisplay');
                const generateBtn = document.getElementById('generateBtn');
                const shareBtn = document.getElementById('shareBtn');
                const changeNameBtn = document.getElementById('changeNameBtn');
                const nameSection = document.getElementById('nameSection');
                const nameInput = document.getElementById('nameInput');
                const saveNameBtn = document.getElementById('saveNameBtn');
                const heartsContainer = document.getElementById('heartsContainer');
                const loveMeterFill = document.getElementById('loveMeterFill');
                const chooseNameOverlay = document.getElementById('chooseNameOverlay');
                const chooseNameText = document.getElementById('chooseNameText');
                const useSavedNameBtn = document.getElementById('useSavedNameBtn');
                const enterNewNameBtn = document.getElementById('enterNewNameBtn');
                const categorySelect = document.getElementById('categorySelect');

                let currentMessage = "";
                let userName = localStorage.getItem('valentineName') || "";
                let currentCategory = localStorage.getItem('valentineCategory') || 'all';
                const recentMessages = [];
                const RECENT_LIMIT = 8;

                const messagePools = {
                    all: messages,
                    cute: [
                        "you make my heart skip a beat! ğŸ’“",
                        "You're peanut butter to my jelly. ğŸ¥œ",
                        "You're candy to my heart. ğŸ¬",
                        "You're marshmallow to my hot chocolate. â˜•",
                        "You're apple of my eye (and cinnamon to my roll). ğŸğŸ¥",
                        "My favorite place is anywhere you're holding my hand ğŸ¤ğŸ’",
                        "You're still the first person I want to text good morning and good night every single day â˜€ï¸ğŸŒ™",
                        "You're the sweetest part of my day ğŸ¯â¤ï¸",
                        "I like you a latte â˜•ğŸ’–",
                        "You + me = my favorite kind of math ğŸ’",
                        "You make my heart smile ğŸ˜ŠğŸ’˜",
                        "If love had a playlist, you'd be my #1 track ğŸ¶â¤ï¸",
                        "Your love feels like home ğŸ¡ğŸ’–"
                    ],
                    funny: [
                        "I love you more than pizza... and that's serious! ğŸ•",
                        "If loving you was a crime, I'd happily do life without parole â¤ï¸",
                        "You're my favorite notification in a world full of noise ğŸ’Œ",
                        "I'd pick you even in a lineup of a million faces. ğŸ«µğŸŒŸ",
                        "If kisses were stars, you'd have your own galaxy by now ğŸŒŒğŸ’‹",
                        "I like you a latte â˜•ğŸ’–",
                        "You + me = my favorite kind of math ğŸ’",
                        "You're my favorite hello and my hardest goodbye ğŸ‘‹ğŸ’—",
                        "If kisses were currency, we'd be millionaires ğŸ’‹ğŸ’°"
                    ],
                    poetic: [
                        "Every love story is beautiful, but ours is my favorite. ğŸ“–ğŸ’•",
                        "You're missing piece I never knew I needed. ğŸ§©",
                        "Every sunrise feels like a love letter addressed to us ğŸŒ…ğŸ’•",
                        "I love you in every language, even the ones I haven't learned yet ğŸŒâ¤ï¸",
                        "You turn my ordinary moments into the best love story ever told ğŸ“–",
                        "You're the plot twist that made my whole story better ğŸ“šğŸ’˜",
                        "You're the kind of magic I didn't know existed until you smiled âœ¨",
                        "With you, even silence feels romantic ğŸŒ™ğŸ’",
                        "You make ordinary moments feel magical âœ¨ğŸ’•",
                        "Your love feels like home ğŸ¡ğŸ’–"
                    ],
                    spicy: [
                        "You're my safe word, my wild side, and everything in between ğŸ”¥â¤ï¸",
                        "Loving you is my favorite bad habit (and I never want to quit) ğŸ˜ˆğŸ’•",
                        "You've stolen a piece of my heart, and I don't want it back. ğŸ’”â¡ï¸â¤ï¸",
                        "I want you closeâ€”now and always ğŸ”¥â¤ï¸",
                        "Come hereâ€”my arms miss you ğŸ¤—ğŸ’˜"
                    ]
                };

                function pickFromPool(pool) {
                    if (!pool || pool.length === 0) return messages[Math.floor(Math.random() * messages.length)];
                    const attempts = Math.min(12, pool.length * 2);
                    for (let k = 0; k < attempts; k++) {
                        const candidate = pool[Math.floor(Math.random() * pool.length)];
                        if (!recentMessages.includes(candidate)) return candidate;
                    }
                    return pool[Math.floor(Math.random() * pool.length)];
                }

                function getRandomMessage() {
                    const pool = messagePools[currentCategory] || messages;
                    const base = pickFromPool(pool);
                    if (userName.trim()) {
                        const prefixes = [
                            `Hey ${userName}, `,
                            `My dearest ${userName}, `,
                            `Darling ${userName}, `,
                            `To my love ${userName}, `,
                            `${userName}, you `
                        ];
                        const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
                        const msg = prefix + base.charAt(0).toLowerCase() + base.slice(1);
                        recentMessages.unshift(base);
                        if (recentMessages.length > RECENT_LIMIT) recentMessages.pop();
                        return msg;
                    }
                    recentMessages.unshift(base);
                    if (recentMessages.length > RECENT_LIMIT) recentMessages.pop();
                    return base;
                }

                function typeWriter(text, element, speed = 40) {
                    element.innerHTML = '';
                    let i = 0;
                    const cursor = '<span class="typing-cursor">|</span>';
                    function type() {
                        if (i < text.length) {
                            element.innerHTML = text.substring(0, i + 1) + cursor;
                            i++;
                            setTimeout(type, speed);
                        } else {
                            element.innerHTML = text;
                            createHeartBurst();
                        }
                    }
                    type();
                }

                function displayNewMessage() {
                    messageDisplay.style.opacity = '0';
                    messageDisplay.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        messageDisplay.style.transform = 'scale(1)';
                        messageDisplay.style.opacity = '1';
                        currentMessage = getRandomMessage();
                        typeWriter(currentMessage, messageDisplay);
                        createConfetti();
                        updateLoveMeter();
                        playSound('success');
                    }, 400);
                }

                function saveName() {
                    userName = nameInput.value.trim();
                    if (userName) {
                        localStorage.setItem('valentineName', userName);
                        nameSection.style.display = 'none';
                        changeNameBtn.style.display = 'inline-flex';
                        displayNewMessage();
                        nameInput.classList.add('shake');
                        setTimeout(() => nameInput.classList.remove('shake'), 500);
                    } else {
                        alert("Please enter a name to make it personal ğŸ’•");
                        nameInput.classList.add('shake');
                        setTimeout(() => nameInput.classList.remove('shake'), 500);
                    }
                }

                async function shareMessage() {
                    const shareData = {
                        title: "Sweet Personalized Valentine Message ğŸ’–",
                        text: `${currentMessage}\n\nSending you this little burst of love from Lusaka! ğŸ’• Made with â¤ï¸`,
                        url: window.location.href
                    };
                    if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
                        try { await navigator.share(shareData); } catch (err) {
                            if (err.name !== 'AbortError') fallbackShare();
                        }
                    } else {
                        fallbackShare();
                    }
                }

                function fallbackShare() {
                    const fallbackText = `${currentMessage}\n\nSending you love! ğŸ’• Check out more at: ${window.location.href}`;
                    navigator.clipboard.writeText(fallbackText)
                        .then(() => alert("Message copied to clipboard! Paste it anywhere to share the love ğŸ’Œ"))
                        .catch(() => alert("Couldn't copy automatically. Here's your message:\n\n" + fallbackText));
                }

                function createHeart() {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.textContent = ['â¤ï¸', 'ğŸ’–', 'ğŸ’•', 'ğŸ’', 'ğŸ’˜'][Math.floor(Math.random() * 5)];
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.animationDuration = (8 + Math.random() * 10) + 's';
                    heart.style.animationDelay = Math.random() * 5 + 's';
                    heartsContainer.appendChild(heart);
                    setTimeout(() => heart.remove(), 15000);
                }

                function createHeartBurst() {
                    for (let i = 0; i < 8; i++) setTimeout(createHeart, i * 80);
                }
                
                function createConfetti() {
                    const colors = ['#ff69b4', '#ff1493', '#c71585', '#ffd700', '#ff6b6b', '#4ecdc4'];
                    for (let i = 0; i < 30; i++) {
                        setTimeout(() => {
                            const confetti = document.createElement('div');
                            confetti.className = 'confetti';
                            confetti.style.left = Math.random() * 100 + 'vw';
                            confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                            confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                            document.body.appendChild(confetti);
                            setTimeout(() => confetti.remove(), 3000);
                        }, i * 50);
                    }
                }
                
                function createEmojiReaction(x, y) {
                    const emojis = ['ğŸ˜', 'ğŸ¥°', 'ğŸ˜˜', 'ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«'];
                    const emoji = document.createElement('div');
                    emoji.className = 'emoji-reaction';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.left = x + 'px';
                    emoji.style.top = y + 'px';
                    document.body.appendChild(emoji);
                    setTimeout(() => emoji.remove(), 1000);
                }
                
                function updateLoveMeter() {
                    const loveLevel = Math.floor(Math.random() * 30) + 70;
                    loveMeterFill.style.width = loveLevel + '%';
                    loveMeterFill.style.background = loveLevel > 90 ? 
                        'linear-gradient(90deg, #ff1493, #ff69b4, #ffd700)' : 
                        'linear-gradient(90deg, #ffd700, #ff69b4)';
                }
                
                function playSound(type) {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    if (type === 'click') {
                        oscillator.frequency.value = 800;
                        gainNode.gain.value = 0.1;
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.1);
                    } else if (type === 'success') {
                        oscillator.frequency.value = 600;
                        gainNode.gain.value = 0.15;
                        oscillator.start();
                        oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.2);
                        oscillator.stop(audioContext.currentTime + 0.3);
                    }
                }
                
                function addClickEffects(element) {
                    element.addEventListener('click', (e) => {
                        element.classList.add('bounce');
                        setTimeout(() => element.classList.remove('bounce'), 600);
                        createEmojiReaction(e.clientX, e.clientY);
                        playSound('click');
                    });
                }

                function openChooseNameModal() {
                    nameSection.style.display = 'none';
                    changeNameBtn.style.display = 'none';
                    chooseNameText.textContent = `Saved name: ${userName}`;
                    chooseNameOverlay.hidden = false;
                    useSavedNameBtn.focus();
                }

                function closeChooseNameModal() {
                    chooseNameOverlay.hidden = true;
                }

                function proceedWithSavedName() {
                    closeChooseNameModal();
                    nameSection.style.display = 'none';
                    changeNameBtn.style.display = 'inline-flex';
                    categorySelect.value = currentCategory;
                    currentMessage = getRandomMessage();
                    typeWriter(currentMessage, messageDisplay, 50);
                    updateLoveMeter();
                }

                function proceedWithNewName() {
                    closeChooseNameModal();
                    nameSection.style.display = 'flex';
                    changeNameBtn.style.display = 'none';
                    nameInput.value = '';
                    categorySelect.value = currentCategory;
                    messageDisplay.textContent = "Enter a new name above to get started! ğŸ’•";
                    nameInput.focus();
                }

                setInterval(createHeart, 1800);
                window.addEventListener('load', () => {
                    if (userName) {
                        openChooseNameModal();
                    } else {
                        nameSection.style.display = 'flex';
                        changeNameBtn.style.display = 'none';
                        categorySelect.value = currentCategory;
                        messageDisplay.textContent = "Enter a name above to get started! ğŸ’•";
                    }
                    for (let i = 0; i < 12; i++) createHeart();
                    
                    addClickEffects(generateBtn);
                    addClickEffects(shareBtn);
                    addClickEffects(saveNameBtn);
                    addClickEffects(changeNameBtn);
                    
                    messageDisplay.addEventListener('mouseenter', () => {
                        messageDisplay.classList.add('bounce');
                        setTimeout(() => messageDisplay.classList.remove('bounce'), 600);
                    });
                    
                    document.addEventListener('click', (e) => {
                        if (Math.random() > 0.7) {
                            createEmojiReaction(e.clientX, e.clientY);
                        }
                    });
                });

                saveNameBtn.addEventListener('click', saveName);
                generateBtn.addEventListener('click', displayNewMessage);
                shareBtn.addEventListener('click', shareMessage);
                categorySelect.addEventListener('change', () => {
                    currentCategory = categorySelect.value;
                    localStorage.setItem('valentineCategory', currentCategory);
                    if (currentMessage) displayNewMessage();
                });
                useSavedNameBtn.addEventListener('click', proceedWithSavedName);
                enterNewNameBtn.addEventListener('click', proceedWithNewName);
                chooseNameOverlay.addEventListener('click', (e) => {
                    if (e.target === chooseNameOverlay) proceedWithNewName();
                });
                document.addEventListener('keydown', (e) => {
                    if (!chooseNameOverlay.hidden && e.key === 'Escape') proceedWithNewName();
                });
                changeNameBtn.addEventListener('click', () => {
                    nameSection.style.display = 'flex';
                    nameInput.value = userName;
                    changeNameBtn.style.display = 'none';
                });
            })();
    </script>
</body>
</html>
